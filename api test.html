<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste API Key Anthropic</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            width: 100%;
            max-width: 500px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .api-input {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        
        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .toggle-btn {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
            float: right;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #f1f3f9;
            color: #667eea;
        }
        
        .status {
            margin-top: 25px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .status.loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            display: block;
        }
        
        .status h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .status p {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .note {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 25px;
            border-radius: 0 8px 8px 0;
            font-size: 13px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .logs {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        .logs.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîë Teste de API Key Anthropic</h1>
        <p class="subtitle">Verifique se sua chave da API Claude est√° funcionando</p>
        
        <div class="api-input">
            <label for="apiKey">Sua API Key:</label>
            <input 
                type="password" 
                id="apiKey" 
                placeholder="sk-ant-..." 
                value=""
            >
            <button class="toggle-btn" onclick="toggleVisibility()">
                üëÅÔ∏è Mostrar
            </button>
        </div>
        
        <button class="btn" onclick="testApiKey()" id="testBtn">
            üß™ Testar API Key
        </button>
        
        <button class="btn btn-secondary" onclick="clearApiKey()">
            üóëÔ∏è Limpar
        </button>
        
        <div id="status" class="status"></div>
        
        <div class="note">
            <strong>üí° Nota:</strong> Sua API Key fica apenas no seu navegador e n√£o √© enviada para nenhum outro servidor. 
            As requisi√ß√µes v√£o diretamente para a API da Anthropic.
        </div>
        
        <button class="btn btn-secondary" onclick="toggleLogs()" style="margin-top: 20px;">
            üìã Mostrar Logs T√©cnicos
        </button>
        
        <div id="logs" class="logs"></div>
    </div>

    <script>
        let showKey = false;
        let logsVisible = false;
        
        // Carrega API Key salva se existir
        window.addEventListener('load', () => {
            const savedKey = localStorage.getItem('test_anthropic_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
                addLog('üîç API Key carregada do localStorage');
            }
        });
        
        function toggleVisibility() {
            showKey = !showKey;
            const input = document.getElementById('apiKey');
            input.type = showKey ? 'text' : 'password';
            document.querySelector('.toggle-btn').textContent = showKey ? 'üôà Ocultar' : 'üëÅÔ∏è Mostrar';
        }
        
        function toggleLogs() {
            logsVisible = !logsVisible;
            document.getElementById('logs').classList.toggle('show', logsVisible);
            document.querySelector('[onclick="toggleLogs()"]').textContent = 
                logsVisible ? 'üìã Ocultar Logs' : 'üìã Mostrar Logs T√©cnicos';
        }
        
        function addLog(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `<div><strong>[${timestamp}]</strong> ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }
        
        async function testApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const status = document.getElementById('status');
            const testBtn = document.getElementById('testBtn');
            
            if (!apiKey) {
                status.className = 'status error';
                status.innerHTML = '<h3>‚ùå Erro</h3><p>Por favor, insira uma API Key</p>';
                addLog('‚ùå Tentativa sem API Key');
                return;
            }
            
            // Salvar no localStorage
            localStorage.setItem('test_anthropic_key', apiKey);
            
            // Verificar formato
            if (!apiKey.startsWith('sk-ant-')) {
                status.className = 'status error';
                status.innerHTML = '<h3>‚ùå Formato Inv√°lido</h3><p>A API Key deve come√ßar com "sk-ant-"</p>';
                addLog('‚ùå Formato inv√°lido: ' + apiKey.substring(0, 10) + '...');
                return;
            }
            
            // Mostrar loading
            status.className = 'status loading';
            status.innerHTML = '<h3><div class="spinner"></div> Testando conex√£o...</h3><p>Conectando √† API da Anthropic...</p>';
            testBtn.disabled = true;
            testBtn.innerHTML = '‚è≥ Testando...';
            
            addLog('üîó Iniciando teste de conex√£o...');
            addLog('üåê Endpoint: https://api.anthropic.com/v1/messages');
            addLog(`üîë API Key: ${apiKey.substring(0, 15)}...`);
            
            try {
                const startTime = Date.now();
                
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-api-key": apiKey,
                        "anthropic-version": "2023-06-01"
                    },
                    body: JSON.stringify({
                        model: "claude-3-haiku-20240307",
                        max_tokens: 5,
                        messages: [{ 
                            role: "user", 
                            content: "Responda apenas com 'OK'" 
                        }]
                    })
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                addLog(`‚è±Ô∏è Tempo de resposta: ${responseTime}ms`);
                addLog(`üìä Status HTTP: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    status.className = 'status success';
                    status.innerHTML = `
                        <h3>‚úÖ API Key Funcionando!</h3>
                        <p><strong>Status:</strong> Sucesso</p>
                        <p><strong>Modelo:</strong> ${data.model || 'N/A'}</p>
                        <p><strong>Tempo:</strong> ${responseTime}ms</p>
                        <p><strong>Tipo:</strong> ${data.type || 'message'}</p>
                        <p>Sua API Key est√° configurada corretamente e pode se comunicar com a API da Anthropic.</p>
                    `;
                    
                    addLog(`‚úÖ Conex√£o bem-sucedida!`);
                    addLog(`ü§ñ Modelo: ${data.model}`);
                    addLog(`üÜî ID: ${data.id}`);
                    
                } else {
                    const errorText = await response.text();
                    addLog(`‚ùå Erro ${response.status}: ${errorText.substring(0, 200)}`);
                    
                    let errorMessage = '';
                    
                    switch (response.status) {
                        case 401:
                            errorMessage = 'API Key inv√°lida, expirada ou n√£o existe';
                            break;
                        case 403:
                            errorMessage = 'Permiss√µes insuficientes ou cota excedida';
                            break;
                        case 404:
                            errorMessage = 'Endpoint n√£o encontrado. Verifique a vers√£o da API';
                            break;
                        case 429:
                            errorMessage = 'Muitas requisi√ß√µes. Limite de taxa excedido';
                            break;
                        case 400:
                            errorMessage = 'Requisi√ß√£o mal formada. Verifique os par√¢metros';
                            break;
                        default:
                            errorMessage = `Erro ${response.status}: ${errorText.substring(0, 100)}`;
                    }
                    
                    status.className = 'status error';
                    status.innerHTML = `
                        <h3>‚ùå Falha na Conex√£o</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Erro:</strong> ${errorMessage}</p>
                        <p><strong>Solu√ß√£o:</strong> Verifique sua API Key no console.anthropic.com</p>
                    `;
                }
                
            } catch (error) {
                addLog(`üí• Erro de rede: ${error.message}`);
                
                status.className = 'status error';
                status.innerHTML = `
                    <h3>‚ùå Erro de Conex√£o</h3>
                    <p><strong>Detalhes:</strong> ${error.message}</p>
                    <p><strong>Poss√≠veis causas:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Sem conex√£o com a internet</li>
                        <li>Bloqueio de CORS (tente rodar em servidor local)</li>
                        <li>Firewall bloqueando a conex√£o</li>
                        <li>Servi√ßo da Anthropic temporariamente indispon√≠vel</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>Como testar:</strong> Abra este arquivo usando um servidor local (n√£o file://)</p>
                `;
            } finally {
                testBtn.disabled = false;
                testBtn.innerHTML = 'üß™ Testar API Key';
            }
        }
        
        function clearApiKey() {
            document.getElementById('apiKey').value = '';
            localStorage.removeItem('test_anthropic_key');
            document.getElementById('status').className = 'status';
            document.getElementById('status').innerHTML = '';
            addLog('üóëÔ∏è API Key limpa do localStorage');
            
            // Reset para senha
            showKey = false;
            document.getElementById('apiKey').type = 'password';
            document.querySelector('.toggle-btn').textContent = 'üëÅÔ∏è Mostrar';
        }
        
        // Adicionar instru√ß√µes iniciais
        addLog('üöÄ Testador de API Key inicializado');
        addLog('üìù Insira sua API Key da Anthropic e clique em "Testar"');
        addLog('üîó Obtenha uma key em: https://console.anthropic.com');
    </script>
</body>
</html>